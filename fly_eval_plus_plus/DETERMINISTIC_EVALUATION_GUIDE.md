# ç¡®å®šæ€§è¯„ä¼°ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç¡®å®šæ€§è¯„ä¼°ç³»ç»Ÿæ˜¯ä¸€ä¸ª**å®Œå…¨ä¸ä½¿ç”¨å¤§æ¨¡å‹**çš„è¯„ä¼°æ¡†æ¶ï¼ŒåŸºäºè§„åˆ™å’Œç¡®å®šæ€§ç®—å­è¿›è¡Œè§„æ¨¡åŒ–è¯„ä¼°ã€‚è¯¥ç³»ç»Ÿå¯ä»¥è¯„ä¼°S1ã€M1ã€M3ä»»åŠ¡çš„æ‰€æœ‰æ¨¡å‹å›å¤ç»“æœï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æŒ‡æ ‡æŠ¥å‘Šã€‚

## æ ¸å¿ƒç‰¹ç‚¹

1. **å®Œå…¨ç¡®å®šæ€§**: ä¸ä½¿ç”¨LLMï¼Œæ‰€æœ‰è¯„ä¼°åŸºäºè§„åˆ™å’Œç¡®å®šæ€§ç®—å­
2. **å¯è§„æ¨¡åŒ–**: å¯ä»¥æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ¨¡å‹çš„æ‰€æœ‰æ ·æœ¬
3. **å¯å¤ç°**: æ‰€æœ‰è¯„ä¼°ç»“æœå®Œå…¨å¯å¤ç°
4. **é«˜æ•ˆ**: ä¸éœ€è¦APIè°ƒç”¨ï¼Œè¯„ä¼°é€Ÿåº¦å¿«

## è¯„ä¼°æµç¨‹

```
è¾“å…¥æ•°æ® â†’ æ•°æ®åŠ è½½ â†’ éªŒè¯å™¨æ£€æŸ¥ â†’ è§„åˆ™èåˆ â†’ è¯„åˆ†è¾“å‡º
```

### 1. æ•°æ®åŠ è½½
- åŠ è½½æ ·æœ¬æ•°æ®ï¼ˆS1/M1/M3ï¼‰
- åŠ è½½æ¨¡å‹è¾“å‡º
- åŠ è½½ç½®ä¿¡åº¦æ•°æ®ï¼ˆå¯é€‰ï¼‰

### 2. éªŒè¯å™¨æ£€æŸ¥ï¼ˆ6ç±»éªŒè¯å™¨ï¼‰
- **NumericValidityChecker**: æ•°å€¼æœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆNaN/Inf/ç±»å‹ï¼‰
- **RangeSanityChecker**: èŒƒå›´åˆç†æ€§æ£€æŸ¥ï¼ˆFIELD_LIMITSï¼‰
- **JumpDynamicsChecker**: çªå˜æ£€æµ‹ï¼ˆJUMP_THRESHOLDSï¼‰
- **CrossFieldConsistencyChecker**: è·¨å­—æ®µä¸€è‡´æ€§æ£€æŸ¥
- **PhysicsConstraintChecker**: ç‰©ç†çº¦æŸæ£€æŸ¥
- **SafetyConstraintChecker**: å®‰å…¨çº¦æŸæ£€æŸ¥

### 3. è§„åˆ™èåˆï¼ˆRuleBasedFusionï¼‰
åŸºäºå›ºå®šåè®®è¿›è¡Œè¯„åˆ†ï¼š
- **Gatingè§„åˆ™**: æ£€æŸ¥critical violations
- **å­åˆ†æ•°è®¡ç®—**: åŸºäºevidenceä¸¥é‡åº¦åŠ æƒ
- **æ€»åˆ†è®¡ç®—**: å›ºå®šæƒé‡èšåˆï¼ˆ0.2:0.3:0.5ï¼‰

### 4. è¯„åˆ†è¾“å‡º
- æ ·æœ¬çº§åˆ«è¯„åˆ†
- æ¨¡å‹çº§åˆ«ç»Ÿè®¡
- ä»»åŠ¡çº§åˆ«æ‘˜è¦

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è¯„ä¼°å•ä¸ªä»»åŠ¡
python fly_eval_plus_plus/run_deterministic_evaluation.py \
    --task S1 \
    --model_output_dir ../data/model_results \
    --reference_data_dir ../data/reference_data \
    --output_dir ./results/deterministic

# è¯„ä¼°æ‰€æœ‰ä»»åŠ¡
python fly_eval_plus_plus/run_deterministic_evaluation.py \
    --all_tasks \
    --model_output_dir ../data/model_results \
    --reference_data_dir ../data/reference_data \
    --output_dir ./results/deterministic
```

### å‚æ•°è¯´æ˜

- `--task`: ä»»åŠ¡ID (S1/M1/M3)
- `--all_tasks`: è¯„ä¼°æ‰€æœ‰ä»»åŠ¡
- `--model_output_dir`: æ¨¡å‹è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: `../data/model_results`ï¼‰
- `--reference_data_dir`: å‚è€ƒæ•°æ®ç›®å½•ï¼ˆé»˜è®¤: `../data/reference_data`ï¼‰
- `--confidence_data_dir`: ç½®ä¿¡åº¦æ•°æ®ç›®å½•ï¼ˆå¯é€‰ï¼‰
- `--output_dir`: è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: `./results/deterministic`ï¼‰
- `--config`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰

### æ•°æ®ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ model_results/
â”‚   â”œâ”€â”€ S1_20251106_020205/          # S1ä»»åŠ¡æ¨¡å‹è¾“å‡º
â”‚   â”‚   â”œâ”€â”€ model1/
â”‚   â”‚   â”‚   â””â”€â”€ test_results_*.jsonl
â”‚   â”‚   â””â”€â”€ model2/
â”‚   â”‚       â””â”€â”€ test_results_*.jsonl
â”‚   â”œâ”€â”€ M1/
â”‚   â”‚   â””â”€â”€ 20251107_155714/         # M1ä»»åŠ¡æ¨¡å‹è¾“å‡º
â”‚   â””â”€â”€ M3/
â”‚       â””â”€â”€ 20251108_155714/         # M3ä»»åŠ¡æ¨¡å‹è¾“å‡º
â””â”€â”€ reference_data/
    â”œâ”€â”€ next_second_pairs.jsonl      # S1å‚è€ƒæ•°æ®
    â”œâ”€â”€ flight_3window_samples.jsonl  # M1/M3å‚è€ƒæ•°æ®
    â””â”€â”€ ...
```

## è¾“å‡ºæ–‡ä»¶

è¯„ä¼°å®Œæˆåï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### 1. è¯„ä¼°è®°å½•ï¼ˆJSONLæ ¼å¼ï¼‰
- `records_{task_id}_deterministic.jsonl`: æ‰€æœ‰æ ·æœ¬çš„è¯„ä¼°è®°å½•

æ¯æ¡è®°å½•åŒ…å«ï¼š
- `sample_id`: æ ·æœ¬ID
- `model_name`: æ¨¡å‹åç§°
- `protocol_result`: åè®®æ£€æŸ¥ç»“æœ
- `evidence_pack`: è¯æ®åŸå­é›†åˆ
- `agent_output`: Agentè¾“å‡ºï¼ˆchecklist, adjudication, attributionï¼‰
- `optional_scores`: è¯„åˆ†ç»“æœ
- `trace`: ç‰ˆæœ¬å’Œå¯å¤ç°æ€§ä¿¡æ¯

### 2. ä»»åŠ¡æ‘˜è¦
- `task_summary_{task_id}_deterministic.json`: ä»»åŠ¡çº§åˆ«ç»Ÿè®¡

åŒ…å«ï¼š
- `total_samples`: æ€»æ ·æœ¬æ•°
- `compliance_rate`: åˆè§„ç‡
- `availability_rate`: å¯ç”¨ç‡
- `eligible_rate`: Eligibleç‡
- `constraint_satisfaction`: çº¦æŸæ»¡è¶³ç‡
- `failure_mode_distribution`: å¤±è´¥æ¨¡å¼åˆ†å¸ƒ
- `conditional_error`: æ¡ä»¶åŒ–è¯¯å·®ç»Ÿè®¡
- `tail_risks`: å°¾éƒ¨é£é™©ï¼ˆP95/P99ï¼‰

### 3. æ¨¡å‹ç”»åƒ
- `model_profiles_{task_id}_deterministic.json`: æ¯ä¸ªæ¨¡å‹çš„è¯¦ç»†ç”»åƒ

åŒ…å«ï¼š
- `avg_score`: å¹³å‡åˆ†
- `availability_rate`: å¯ç”¨ç‡
- `eligible_rate`: Eligibleç‡
- `constraint_satisfaction_profile`: çº¦æŸæ»¡è¶³ç”»åƒ
- `failure_mode_distribution`: å¤±è´¥æ¨¡å¼åˆ†å¸ƒ
- `conditional_error`: æ¡ä»¶åŒ–è¯¯å·®
- `tail_risks`: å°¾éƒ¨é£é™©

### 4. æ¨¡å‹æ‘˜è¦
- `model_summaries_{task_id}_deterministic.json`: æ¨¡å‹æ‘˜è¦ï¼ˆç®€åŒ–ç‰ˆï¼‰

åŒ…å«ï¼š
- `sample_count`: æ ·æœ¬æ•°
- `avg_score`: å¹³å‡åˆ†
- `eligible_rate`: Eligibleç‡
- `scores`: æ‰€æœ‰æ ·æœ¬çš„åˆ†æ•°åˆ—è¡¨

### 5. æŒ‡æ ‡æŠ¥å‘Š
- `metrics_report_{task_id}_deterministic.md`: Markdownæ ¼å¼çš„æŒ‡æ ‡æŠ¥å‘Š

åŒ…å«ï¼š
- ä»»åŠ¡çº§åˆ«ç»Ÿè®¡
- æ¨¡å‹æ’åï¼ˆæŒ‰å¹³å‡åˆ†ï¼‰
- è¯¦ç»†æŒ‡æ ‡ï¼ˆæ¯ä¸ªæ¨¡å‹çš„ç»Ÿè®¡ï¼‰

### 6. ç»¼åˆæŠ¥å‘Š
- `evaluation_summary_deterministic.json`: æ‰€æœ‰ä»»åŠ¡çš„ç»¼åˆæŠ¥å‘Š

## è¯„åˆ†æ ‡å‡†

### å›ºå®šåè®®ï¼ˆ0.2:0.3:0.5ï¼‰

1. **Gatingåˆ†æ•° (20%)**: åè®®åˆè§„æ€§
   - JSONè§£ææˆåŠŸ
   - å­—æ®µå®Œæ•´æ€§
   - ç±»å‹éªŒè¯

2. **å­åˆ†æ•° (30%)**: çº¦æŸæ»¡è¶³åº¦
   - æ•°å€¼æœ‰æ•ˆæ€§
   - èŒƒå›´åˆç†æ€§
   - çªå˜æ£€æµ‹
   - è·¨å­—æ®µä¸€è‡´æ€§
   - ç‰©ç†çº¦æŸ
   - å®‰å…¨çº¦æŸ

3. **æ€»åˆ† (50%)**: é¢„æµ‹è´¨é‡
   - æ¡ä»¶åŒ–MAE/RMSEï¼ˆä»…å¯¹eligibleæ ·æœ¬ï¼‰
   - è¯¯å·®åˆ†å¸ƒç»Ÿè®¡

### Eligibilityåˆ¤å®š

æ ·æœ¬å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰èƒ½æˆä¸ºeligibleï¼š
- æ— critical protocol failure
- æ— critical safety violation
- æ— key field missing

åªæœ‰eligibleæ ·æœ¬ç”¨äºæ¡ä»¶åŒ–è¯¯å·®ç»Ÿè®¡ã€‚

## å…³é”®é˜ˆå€¼

### FIELD_LIMITSï¼ˆå­—æ®µèŒƒå›´é™åˆ¶ï¼‰

| å­—æ®µ | æœ€å°å€¼ | æœ€å¤§å€¼ | å•ä½ |
|------|--------|--------|------|
| Latitude (WGS84 deg) | -90 | 90 | åº¦ |
| Longitude (WGS84 deg) | -180 | 180 | åº¦ |
| GPS Altitude (WGS84 ft) | 0 | 10000 | è‹±å°º |
| GPS Ground Speed (kt) | 0 | 250 | èŠ‚ |
| Vertical Speed (fpm) | -4000 | 4000 | è‹±å°º/åˆ†é’Ÿ |
| ... | ... | ... | ... |

### JUMP_THRESHOLDSï¼ˆçªå˜é˜ˆå€¼ï¼‰

| å­—æ®µ | é˜ˆå€¼ | å•ä½ | è¯´æ˜ |
|------|------|------|------|
| Latitude (WGS84 deg) | 0.002 | åº¦/ç§’ | ç›¸é‚»æ ·æœ¬é—´æœ€å¤§å˜åŒ– |
| Longitude (WGS84 deg) | 0.002 | åº¦/ç§’ | ç›¸é‚»æ ·æœ¬é—´æœ€å¤§å˜åŒ– |
| GPS Altitude (WGS84 ft) | 67 | è‹±å°º/ç§’ | ç›¸é‚»æ ·æœ¬é—´æœ€å¤§å˜åŒ– |
| GPS Ground Speed (kt) | 10 | èŠ‚/ç§’ | ç›¸é‚»æ ·æœ¬é—´æœ€å¤§å˜åŒ– |
| ... | ... | ... | ... |

### è·¨å­—æ®µä¸€è‡´æ€§é˜ˆå€¼

| æ£€æŸ¥é¡¹ | Criticalé˜ˆå€¼ | Warningé˜ˆå€¼ | å•ä½ |
|--------|-------------|------------|------|
| GPS Alt vs Baro Altå·®å¼‚ | 500 | 100 | è‹±å°º |
| Ground Speed vs Velocityå·®å¼‚ | 5 | 2 | èŠ‚ |
| Track vs Velocityæ–¹å‘å·®å¼‚ | 10 | 5 | åº¦ |

### å®‰å…¨çº¦æŸé˜ˆå€¼

| æ£€æŸ¥é¡¹ | Criticalé˜ˆå€¼ | Warningé˜ˆå€¼ | å•ä½ |
|--------|-------------|------------|------|
| å¿«é€Ÿä¸‹é™ | -3000 | -2000 | è‹±å°º/åˆ†é’Ÿ |
| æç«¯é€Ÿåº¦ï¼ˆè¿‡é«˜ï¼‰ | 250 | 200 | èŠ‚ |
| æç«¯é«˜åº¦ï¼ˆè¿‡é«˜ï¼‰ | 10000 | 8000 | è‹±å°º |

## ç¤ºä¾‹è¾“å‡º

### è¯„ä¼°è¿‡ç¨‹è¾“å‡º

```
================================================================================
å¼€å§‹è¯„ä¼°ä»»åŠ¡: S1
================================================================================

ğŸ“‚ åŠ è½½æ•°æ®...
   - æ ·æœ¬æ•°: 708
   - æ¨¡å‹æ•°: 21

ğŸ“Š è¯„ä¼°æ¨¡å‹: claude-3-7-sonnet-20250219
  claude-3-7-sonnet-20250219: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 708/708 [00:45<00:00, 15.6æ ·æœ¬/s]
   âœ… å®Œæˆ: 708ä¸ªæ ·æœ¬, å¹³å‡åˆ†: 75.23, Eligibleç‡: 2.40%

ğŸ“Š è¯„ä¼°æ¨¡å‹: gpt-4o
  gpt-4o: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 708/708 [00:42<00:00, 16.8æ ·æœ¬/s]
   âœ… å®Œæˆ: 708ä¸ªæ ·æœ¬, å¹³å‡åˆ†: 78.56, Eligibleç‡: 3.12%

...

ğŸ’¾ ä¿å­˜ç»“æœåˆ°: ./results/deterministic
   âœ… è®°å½•æ–‡ä»¶: records_S1_deterministic.jsonl (14868æ¡)
   âœ… ä»»åŠ¡æ‘˜è¦: task_summary_S1_deterministic.json
   âœ… æ¨¡å‹ç”»åƒ: model_profiles_S1_deterministic.json
   âœ… æ¨¡å‹æ‘˜è¦: model_summaries_S1_deterministic.json
   âœ… æŒ‡æ ‡æŠ¥å‘Š: metrics_report_S1_deterministic.md
```

### æŒ‡æ ‡æŠ¥å‘Šç¤ºä¾‹

```markdown
# ç¡®å®šæ€§è¯„ä¼°æŒ‡æ ‡æŠ¥å‘Š - S1

**ç”Ÿæˆæ—¶é—´**: 2025-01-27 20:00:00
**è¯„ä¼°æ–¹æ³•**: ç¡®å®šæ€§è§„åˆ™å’Œç®—å­ï¼ˆä¸ä½¿ç”¨LLMï¼‰

## ä»»åŠ¡çº§åˆ«ç»Ÿè®¡

- **æ€»æ ·æœ¬æ•°**: 708
- **æ€»æ¨¡å‹æ•°**: 21
- **åˆè§„ç‡**: 95.23%
- **å¯ç”¨ç‡**: 98.45%
- **Eligibleç‡**: 2.40%

## æ¨¡å‹æ’åï¼ˆæŒ‰å¹³å‡åˆ†ï¼‰

| æ’å | æ¨¡å‹åç§° | æ ·æœ¬æ•° | å¹³å‡åˆ† | Eligibleç‡ |
|------|----------|--------|--------|------------|
| 1 | gpt-4o | 708 | 78.56 | 3.12% |
| 2 | claude-3-7-sonnet-20250219 | 708 | 75.23 | 2.40% |
| 3 | qwen3-32b | 708 | 72.15 | 2.12% |
...
```

## ä¸LLM Judgeç‰ˆæœ¬çš„åŒºåˆ«

| ç‰¹æ€§ | ç¡®å®šæ€§ç‰ˆæœ¬ | LLM Judgeç‰ˆæœ¬ |
|------|-----------|---------------|
| ä½¿ç”¨LLM | âŒ ä¸ä½¿ç”¨ | âœ… ä½¿ç”¨ |
| è¯„ä¼°é€Ÿåº¦ | å¿«ï¼ˆæ— APIè°ƒç”¨ï¼‰ | æ…¢ï¼ˆéœ€è¦APIè°ƒç”¨ï¼‰ |
| æˆæœ¬ | æ— æˆæœ¬ | æœ‰APIæˆæœ¬ |
| å¯å¤ç°æ€§ | 100%å¯å¤ç° | ä¾èµ–LLMç¨³å®šæ€§ |
| è¯„ä¼°ç»´åº¦ | 5ä¸ªç»´åº¦ï¼ˆè§„åˆ™å®šä¹‰ï¼‰ | 5ä¸ªç»´åº¦ï¼ˆLLMè£å†³ï¼‰ |
| è¯„åˆ†æ–¹å¼ | å›ºå®šåè®®ï¼ˆ0.2:0.3:0.5ï¼‰ | LLMç­‰çº§æ˜ å°„ |
| é€‚ç”¨åœºæ™¯ | å¤§è§„æ¨¡æ‰¹é‡è¯„ä¼° | éœ€è¦å¤æ‚æ¨ç†çš„åœºæ™¯ |

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è·¯å¾„**: ç¡®ä¿æ•°æ®ç›®å½•ç»“æ„æ­£ç¡®ï¼Œæ¨¡å‹è¾“å‡ºæ–‡ä»¶å‘½åç¬¦åˆè§„èŒƒ
2. **å†…å­˜ä½¿ç”¨**: å¤§è§„æ¨¡è¯„ä¼°å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†
3. **è¯„ä¼°æ—¶é—´**: è¯„ä¼°æ—¶é—´å–å†³äºæ ·æœ¬æ•°å’Œæ¨¡å‹æ•°ï¼Œ708æ ·æœ¬Ã—21æ¨¡å‹çº¦éœ€15-20åˆ†é’Ÿ
4. **ç»“æœä¸€è‡´æ€§**: ç¡®å®šæ€§è¯„ä¼°ç»“æœå®Œå…¨ä¸€è‡´ï¼Œå¤šæ¬¡è¿è¡Œç»“æœç›¸åŒ

## æ•…éšœæ’é™¤

### é—®é¢˜1: æ‰¾ä¸åˆ°æ¨¡å‹è¾“å‡ºæ–‡ä»¶
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥`--model_output_dir`è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ç›®å½•ç»“æ„ç¬¦åˆè¦æ±‚

### é—®é¢˜2: æ ·æœ¬IDä¸åŒ¹é…
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿æ¨¡å‹è¾“å‡ºæ–‡ä»¶ä¸­çš„`sample_id`ä¸å‚è€ƒæ•°æ®ä¸­çš„`sample_id`ä¸€è‡´

### é—®é¢˜3: å†…å­˜ä¸è¶³
**è§£å†³æ–¹æ¡ˆ**: å‡å°‘æ‰¹é‡å¤„ç†çš„æ ·æœ¬æ•°ï¼Œæˆ–ä½¿ç”¨å¢é‡ä¿å­˜æ¨¡å¼

## æ‰©å±•å’Œå®šåˆ¶

### è‡ªå®šä¹‰è¯„åˆ†åè®®

ä¿®æ”¹`fly_eval_plus_plus/fusion/rule_based_fusion.py`ä¸­çš„æƒé‡ï¼š

```python
# ä¿®æ”¹æƒé‡
GATING_WEIGHT = 0.2  # Gatingåˆ†æ•°æƒé‡
SUBSCORE_WEIGHT = 0.3  # å­åˆ†æ•°æƒé‡
TOTAL_SCORE_WEIGHT = 0.5  # æ€»åˆ†æƒé‡
```

### è‡ªå®šä¹‰é˜ˆå€¼

ä¿®æ”¹`validity_standard.py`å’Œ`validity_change_standard.py`ä¸­çš„é˜ˆå€¼å®šä¹‰ã€‚

### æ·»åŠ æ–°çš„éªŒè¯å™¨

1. åˆ›å»ºæ–°çš„éªŒè¯å™¨ç±»ï¼ˆç»§æ‰¿`Verifier`ï¼‰
2. åœ¨`main.py`ä¸­æ³¨å†ŒéªŒè¯å™¨
3. æ›´æ–°`rule_based_fusion.py`ä»¥åŒ…å«æ–°éªŒè¯å™¨çš„è¯„åˆ†é€»è¾‘

## å‚è€ƒæ–‡æ¡£

- `METHODOLOGY_PAPER.md`: æ–¹æ³•è®ºæ–‡æ¡£
- `TERMINOLOGY_DEFINITIONS.md`: æœ¯è¯­å®šä¹‰
- `METRICS_AND_RUBRIC_WITH_CASES.md`: æŒ‡æ ‡å’Œæ¡ˆä¾‹è¯´æ˜

## è”ç³»å’Œæ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒé¡¹ç›®æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

